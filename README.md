# Java Base Docker Images

This is a repository for Java Docker base images used for running JVM applications.

You can find the images [in our Docker Hub repository](https://hub.docker.com/u/manifoldfinance).

The Docker build files for these images are generated by
[fish-pepper](https://github.com/fabric8io-images/fish-pepper), a sophisticated
template system for generation Docker builds. `fish-pepper` allows
the composition of various building blocks, so that parametrized Docker
builds are easily possible.

The Java base images come in different flavours:

- Based on [CentOS 7](https://www.centos.org/) or [Alpine Linux](https://www.alpinelinux.org/)
  (experimental) or [Red Hat Universal Base Image](https://developers.redhat.com/products/rhel/ubi/)
  or [Ubuntu 20.04](https://ubuntu.com/)
- [OpenJDK 17](http://openjdk.java.net/projects/jdk/17/) only (for previous versions refer
  to [original repository](https://github.com/fabric8io-images/java) maintained by Fabric8 team)
- As JDK (Java Developer Toolkit) or as JRE (Java Runtime Environment)

All images add the following features:

- [agent-bond](https://github.com/fabric8io/agent-bond) is included
  which combines [Jolokia](http://www.jolokia.org) and
  [jmx_exporter](https://github.com/prometheus/jmx_exporter)
- A startup script [run-java.sh](https://github.com/fabric8io/run-java-sh) is
  included which transparently starts Java application provided as FAT-jar or
  traditionally with a bunch of jar dependencies.

How to use these images and what environment variables can be used are described in the associated [README](images/) files.

## Quick Start

If using [`nix`](https://nixos.org/) and [`direnv`](https://direnv.net/), it will auto-setup a ready to use environment to start hacking quickly:

```sh
$ direnv allow
```

And after that:

```sh
$ just
```

It will display the list of all available commands and shortcuts:

```
just --list
Available recipes:
    build
    b                 # alias for `build`
    default           # Lists all available commands
    fish-pepper *ARGS
    fp *ARGS          # alias for `fish-pepper`
    fmt
    f                 # alias for `fmt`
    make
    m                 # alias for `make`
```

Otherwise, you'll need to install the following dependencies manually (and you can skip safely installing `nix` package manager):

- [`just`](https://github.com/casey/just)
- [`direnv`](https://direnv.net/)
- [`treefmt`](https://github.com/numtide/treefmt)

### List of available commands

For calling `fish-pepper`:

```sh
$ just fish-pepper <ARGS> # just fp <ARGS>
```

For rendering docker templates (alias of `fish-pepper build`):

```sh
$ just build # just b
```

For rendering and building docker templates using available docker daemon (alias of `fish-pepper make`):

```sh
$ just make # just m
```

For formatting source code with `treefmt`:

```sh
$ just fmt # just f
```

## Differences with the original repository

There are some notable differences with upstream:

- Inclusion of `nix` and `direnv` to have a reproducible dev environment.
- Support for more OSes like Ubuntu and removal of Jboss one.
- Support for JDK17.
- Minor corrections to Dockerfiles suggested by [`hadolint`](https://github.com/hadolint/hadolint).

If you detect any issues with the provided images, feel free to open an issue (also, a PR with the fix will be greatly appreciated!).
